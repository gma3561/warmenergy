function doPost(e) {
  try {
    // í˜„ì¬ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ê°€ì ¸ì˜¤ê¸°
    const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();

    // ì²« ë²ˆì§¸ í–‰ì´ ë¹„ì–´ìˆìœ¼ë©´ í—¤ë” ì¶”ê°€
    if (sheet.getLastRow() === 0) {
      sheet.appendRow([
        'ì ‘ìˆ˜ì‹œê°„',
        'íšŒì‚¬ëª…',
        'ë‹´ë‹¹ìëª…',
        'ì§ê¸‰',
        'ì—°ë½ì²˜',
        'ì´ë©”ì¼',
        'ì‚¬ì—…ì¥ ì£¼ì†Œ',
        'ì›” í‰ê·  ì „ê¸°ìš”ê¸ˆ',
        'ë¬¸ì˜ì‚¬í•­'
      ]);
    }

    // POST ë°ì´í„° íŒŒì‹±
    const data = JSON.parse(e.postData.contents);

    // í˜„ì¬ ì‹œê°„ (í•œêµ­ ì‹œê°„)
    const now = new Date();
    const kstTime = Utilities.formatDate(now, 'Asia/Seoul', 'yyyy-MM-dd HH:mm:ss');

    // ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì— ë°ì´í„° ì¶”ê°€
    sheet.appendRow([
      kstTime,
      data.company,
      data.name,
      data.position || '',
      data.phone,
      data.email || '',
      data.location,
      data.electricBill || '',
      data.message || ''
    ]);

    // ì´ë©”ì¼ ì „ì†¡
    const emailSubject = `[ì „ê¸°ìš”ê¸ˆ ì ˆê° ì»¨ì„¤íŒ…] ${data.company} - ${data.name}ë‹˜ ë¬¸ì˜`;

    const emailBody = `
ìƒˆë¡œìš´ ì „ê¸°ìš”ê¸ˆ ì ˆê° ì»¨ì„¤íŒ… ë¬¸ì˜ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ íšŒì‚¬ ì •ë³´
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
íšŒì‚¬ëª…: ${data.company}
ë‹´ë‹¹ìëª…: ${data.name}
ì§ê¸‰: ${data.position || 'ë¯¸ì…ë ¥'}
ì—°ë½ì²˜: ${data.phone}
ì´ë©”ì¼: ${data.email || 'ë¯¸ì…ë ¥'}
ì‚¬ì—…ì¥ ì£¼ì†Œ: ${data.location}
ì›” í‰ê·  ì „ê¸°ìš”ê¸ˆ: ${data.electricBill || 'ë¯¸ì…ë ¥'}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¬ ë¬¸ì˜ì‚¬í•­
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
${data.message || 'ë¬¸ì˜ì‚¬í•­ ì—†ìŒ'}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š ë°ì´í„° í™•ì¸
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ì ‘ìˆ˜ ì‹œê°„: ${kstTime}
ìŠ¤í”„ë ˆë“œì‹œíŠ¸: ${SpreadsheetApp.getActiveSpreadsheet().getUrl()}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    `.trim();

    // ì´ë©”ì¼ ì „ì†¡
    GmailApp.sendEmail(
      'lucas@warmguys.com',  // ë°›ëŠ” ì‚¬ëŒ
      emailSubject,          // ì œëª©
      emailBody,             // ë³¸ë¬¸
      {
        name: 'ì „ê¸°ìš”ê¸ˆ ì ˆê° ì»¨ì„¤íŒ… ì‹œìŠ¤í…œ',
        replyTo: data.email || 'noreply@warmenergy.com'
      }
    );

    // ì„±ê³µ ì‘ë‹µ
    return ContentService
      .createTextOutput(JSON.stringify({
        'status': 'success',
        'message': 'ë¬¸ì˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.'
      }))
      .setMimeType(ContentService.MimeType.JSON);

  } catch (error) {
    // ì—ëŸ¬ ì‘ë‹µ
    return ContentService
      .createTextOutput(JSON.stringify({
        'status': 'error',
        'message': 'ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
        'error': error.toString()
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// GET ìš”ì²­ ì²˜ë¦¬ (í…ŒìŠ¤íŠ¸ìš©)
function doGet(e) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet();
  const data = sheet.getActiveSheet().getDataRange().getValues();

  return ContentService
    .createTextOutput(JSON.stringify({
      'status': 'ready',
      'message': 'APIê°€ ì •ìƒ ì‘ë™ ì¤‘ì…ë‹ˆë‹¤.',
      'total_submissions': Math.max(0, data.length - 1),
      'sheet_url': sheet.getUrl()
    }))
    .setMimeType(ContentService.MimeType.JSON);
}